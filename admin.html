<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>æºªçŸ³ - ç®¡ç†åå°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    <style>
        /* ç®¡ç†åå°é¢å¤–æ ·å¼ */
        .admin-header {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(6, 182, 212, 0.1));
            border-bottom: 1px solid rgba(139, 92, 246, 0.3);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .admin-title {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--purple) 0%, var(--cyan) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn-logout {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .btn-home {
            background: rgba(107, 114, 128, 0.2);
            color: var(--text-secondary);
            border: 1px solid rgba(107, 114, 128, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .btn-home:hover {
            background: rgba(107, 114, 128, 0.3);
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--purple), var(--cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .posts-table {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .post-list {
            max-height: 60vh;
            overflow-y: auto;
        }

        .post-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }

        .post-item:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .post-item:last-child {
            border-bottom: none;
        }

        .post-info {
            flex: 1;
        }

        .post-item-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .post-item-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .post-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.875rem;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .btn-edit {
            background: rgba(139, 92, 246, 0.2);
            color: var(--purple);
        }

        .btn-edit:hover {
            background: rgba(139, 92, 246, 0.3);
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .btn-delete:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* ç™»å½•é¡µé¢ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .login-box {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 3rem;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--purple), var(--cyan));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-input {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            color: var(--text);
            font-size: 1rem;
            text-align: center;
            letter-spacing: 0.2em;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--purple);
        }

        .login-btn {
            background: linear-gradient(135deg, var(--purple), var(--cyan));
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        .login-error {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .login-error.show {
            display: block;
        }
    </style>
</head>

<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginView" class="login-container">
        <div class="login-box">
            <div class="login-icon">ğŸ”</div>
            <h1 class="login-title">ç®¡ç†åå°</h1>
            <p class="login-subtitle">è¯·è¾“å…¥ç®¡ç†å¯†ç </p>
            <form class="login-form" id="loginForm">
                <input type="password" class="login-input" id="passwordInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="20"
                    autocomplete="off">
                <p class="login-error" id="loginError">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</p>
                <button type="submit" class="login-btn">è¿›å…¥åå°</button>
            </form>
        </div>
    </div>

    <!-- ç®¡ç†åå° -->
    <div id="adminView" class="hidden">
        <header class="admin-header">
            <div class="admin-title">ğŸ”§ æºªçŸ³ç®¡ç†åå°</div>
            <div class="admin-actions">
                <a href="index.html" class="btn-home">â† è¿”å›å‰å°</a>
                <button class="btn-logout" id="logoutBtn">é€€å‡ºç™»å½•</button>
            </div>
        </header>

        <div class="admin-container">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalPosts">0</div>
                    <div class="stat-label">æ–‡ç« æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalViews">0</div>
                    <div class="stat-label">æ€»æµè§ˆé‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalWords">0</div>
                    <div class="stat-label">æ€»å­—æ•°</div>
                </div>
            </div>

            <!-- æ–‡ç« åˆ—è¡¨ -->
            <div class="posts-table">
                <div class="table-header">
                    <h2 class="table-title">æ–‡ç« ç®¡ç†</h2>
                    <button class="btn-primary" id="newPostBtn">
                        <span>+</span> æ–°å»ºæ–‡ç« 
                    </button>
                </div>
                <div class="post-list" id="postList">
                    <!-- åŠ¨æ€æ¸²æŸ“ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘å™¨å¼¹çª— -->
    <div class="modal hidden" id="editorModal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <h3 class="modal-title" id="editorModalTitle">æ–°å»ºæ–‡ç« </h3>
            <div class="editor-field">
                <label class="editor-label">æ ‡é¢˜</label>
                <input type="text" class="editor-title-input" id="editorTitle" placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜..." maxlength="100">
            </div>
            <div class="editor-field">
                <label class="editor-label">å†…å®¹</label>
                <textarea class="editor-content-input" id="editorContent" placeholder="å¼€å§‹å†™ä½œ..."
                    style="min-height: 300px;"></textarea>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" id="cancelEditBtn">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-confirm" id="savePostBtn">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal hidden" id="deleteModal">
        <div class="modal-content">
            <h3 class="modal-title">ç¡®è®¤åˆ é™¤</h3>
            <p class="modal-text">ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" id="cancelDeleteBtn">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-confirm" id="confirmDeleteBtn">åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- Toast å®¹å™¨ -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        /**
         * æºªçŸ³ç®¡ç†åå°
         */
        const Admin = {
            posts: [],
            editingPostId: null,
            deletePostId: null,
            // ç®¡ç†å¯†ç  (å®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨åç«¯éªŒè¯)
            ADMIN_PASSWORD: 'xishi2024',

            init() {
                this.checkAuth();
                this.bindEvents();
            },

            checkAuth() {
                const isLoggedIn = sessionStorage.getItem('xishi_admin_auth');
                if (isLoggedIn === 'true') {
                    this.showAdmin();
                }
            },

            bindEvents() {
                // ç™»å½•
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.login();
                });

                // é€€å‡º
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.logout();
                });

                // æ–°å»ºæ–‡ç« 
                document.getElementById('newPostBtn').addEventListener('click', () => {
                    this.openEditor();
                });

                // å–æ¶ˆç¼–è¾‘
                document.getElementById('cancelEditBtn').addEventListener('click', () => {
                    document.getElementById('editorModal').classList.add('hidden');
                });

                // ä¿å­˜æ–‡ç« 
                document.getElementById('savePostBtn').addEventListener('click', () => {
                    this.savePost();
                });

                // å–æ¶ˆåˆ é™¤
                document.getElementById('cancelDeleteBtn').addEventListener('click', () => {
                    document.getElementById('deleteModal').classList.add('hidden');
                });

                // ç¡®è®¤åˆ é™¤
                document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
                    this.deletePost();
                });
            },

            login() {
                const password = document.getElementById('passwordInput').value;
                if (password === this.ADMIN_PASSWORD) {
                    sessionStorage.setItem('xishi_admin_auth', 'true');
                    this.showAdmin();
                } else {
                    document.getElementById('loginError').classList.add('show');
                    document.getElementById('passwordInput').value = '';
                    setTimeout(() => {
                        document.getElementById('loginError').classList.remove('show');
                    }, 3000);
                }
            },

            logout() {
                sessionStorage.removeItem('xishi_admin_auth');
                document.getElementById('adminView').classList.add('hidden');
                document.getElementById('loginView').classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
            },

            showAdmin() {
                document.getElementById('loginView').classList.add('hidden');
                document.getElementById('adminView').classList.remove('hidden');
                this.loadPosts();
                this.renderPosts();
                this.updateStats();
            },

            loadPosts() {
                const saved = localStorage.getItem('xishi_posts');
                if (saved) {
                    this.posts = JSON.parse(saved);
                } else {
                    this.posts = [
                        {
                            id: Date.now(),
                            title: 'æ¬¢è¿æ¥åˆ°æºªçŸ³',
                            content: 'æºªçŸ³æ˜¯ä¸€ä¸ªä¼˜é›…çš„çº¯æ–‡å­—å†…å®¹åˆ†äº«å¹³å°ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥è‡ªç”±åœ°ä¹¦å†™ä½ çš„æƒ³æ³•ï¼Œåˆ†äº«ä½ çš„æ•…äº‹ã€‚\n\næˆ‘ä»¬ç›¸ä¿¡ï¼Œæœ€å¥½çš„å†…å®¹ä¸éœ€è¦åä¸½çš„è£…é¥°ï¼Œæ–‡å­—æœ¬èº«å°±æ˜¯æœ€æœ‰åŠ›é‡çš„è¡¨è¾¾æ–¹å¼ã€‚',
                            createdAt: Date.now(),
                            views: 128
                        }
                    ];
                    this.savePosts();
                }
            },

            savePosts() {
                localStorage.setItem('xishi_posts', JSON.stringify(this.posts));
            },

            renderPosts() {
                const list = document.getElementById('postList');
                if (this.posts.length === 0) {
                    list.innerHTML = '<div style="padding: 3rem; text-align: center; color: var(--text-secondary);">æš‚æ— æ–‡ç« ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º</div>';
                    return;
                }

                list.innerHTML = this.posts.map(post => {
                    const date = new Date(post.createdAt).toLocaleDateString('zh-CN');
                    const wordCount = post.content.replace(/\s/g, '').length;
                    return `
                        <div class="post-item">
                            <div class="post-info">
                                <div class="post-item-title">${this.escapeHtml(post.title)}</div>
                                <div class="post-item-meta">${date} Â· ${wordCount} å­— Â· ${post.views || 0} æ¬¡æµè§ˆ</div>
                            </div>
                            <div class="post-actions">
                                <button class="btn-sm btn-edit" onclick="Admin.openEditor(${post.id})">ç¼–è¾‘</button>
                                <button class="btn-sm btn-delete" onclick="Admin.confirmDelete(${post.id})">åˆ é™¤</button>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            updateStats() {
                document.getElementById('totalPosts').textContent = this.posts.length;
                document.getElementById('totalViews').textContent = this.posts.reduce((sum, p) => sum + (p.views || 0), 0);
                document.getElementById('totalWords').textContent = this.posts.reduce((sum, p) => sum + p.content.replace(/\s/g, '').length, 0);
            },

            openEditor(id = null) {
                this.editingPostId = id;
                const modal = document.getElementById('editorModal');
                const title = document.getElementById('editorTitle');
                const content = document.getElementById('editorContent');
                const modalTitle = document.getElementById('editorModalTitle');

                if (id) {
                    const post = this.posts.find(p => p.id === id);
                    if (post) {
                        title.value = post.title;
                        content.value = post.content;
                        modalTitle.textContent = 'ç¼–è¾‘æ–‡ç« ';
                    }
                } else {
                    title.value = '';
                    content.value = '';
                    modalTitle.textContent = 'æ–°å»ºæ–‡ç« ';
                }

                modal.classList.remove('hidden');
                title.focus();
            },

            savePost() {
                const title = document.getElementById('editorTitle').value.trim();
                const content = document.getElementById('editorContent').value.trim();

                if (!title) {
                    this.showToast('è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜', 'error');
                    return;
                }
                if (!content) {
                    this.showToast('è¯·è¾“å…¥æ–‡ç« å†…å®¹', 'error');
                    return;
                }

                if (this.editingPostId) {
                    const index = this.posts.findIndex(p => p.id === this.editingPostId);
                    if (index !== -1) {
                        this.posts[index].title = title;
                        this.posts[index].content = content;
                        this.posts[index].updatedAt = Date.now();
                    }
                    this.showToast('æ–‡ç« å·²æ›´æ–°', 'success');
                } else {
                    this.posts.unshift({
                        id: Date.now(),
                        title,
                        content,
                        createdAt: Date.now(),
                        views: 0
                    });
                    this.showToast('æ–‡ç« å·²å‘å¸ƒ', 'success');
                }

                this.savePosts();
                this.renderPosts();
                this.updateStats();
                document.getElementById('editorModal').classList.add('hidden');
            },

            confirmDelete(id) {
                this.deletePostId = id;
                document.getElementById('deleteModal').classList.remove('hidden');
            },

            deletePost() {
                this.posts = this.posts.filter(p => p.id !== this.deletePostId);
                this.savePosts();
                this.renderPosts();
                this.updateStats();
                document.getElementById('deleteModal').classList.add('hidden');
                this.showToast('æ–‡ç« å·²åˆ é™¤', 'success');
            },

            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                container.appendChild(toast);
                setTimeout(() => {
                    toast.classList.add('toast-out');
                    setTimeout(() => toast.remove(), 250);
                }, 3000);
            },

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            Admin.init();
        });
    </script>
</body>

</html>